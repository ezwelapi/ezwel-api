<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ezwel.htl.interfaces.server.repository.EzcApiBatcLogMapper">
<!--
 * History : SQL Mapper Generated By iCodeManager Made by API Team KSW
 *
 * 버전          성명                   일자              		변경내용
 * =======       ================       ===================		=================
 * 0.0.1         iCodeManager     2019-01-17 16:04:15 	신규작성 
 * 
 * @since 2019-01-17 16:04:15
 * @version 0.0.1
 * @author ksw
 * @see "DBIO Mapper"
 * -->
<insert id="insertEzcApiBatcLog" parameterType="ezcApiBatcLog">
INSERT INTO EZC_API_BATC_LOG(	/* EZC API 배치 로그 */
	 BATC_EXEC_CD	/* 배치 실행 코드, VARCHAR2(32) */
	,THED_GUID	/* 쓰레드 GUID, VARCHAR2(32) */
	,BATC_PROG_TYPE	/* 배치 프로그램 타입, VARCHAR2(1000) */
	,BATC_DESC	/* 배치 설명, VARCHAR2(4000) */
	,BATC_LOG_TYPE	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
	,EXEC_STRT_MLIS_SECD	/* 실행 시작 밀리 초, NUMBER(0,22) */
	,EXEC_END_MLIS_SECD	/* 실행 종료 밀리 초, NUMBER(0,22) */
	,TOTL_LAP_MLIS_SECD	/* 전체 수행 밀리 초, NUMBER(0,22) */
	,ERR_MSG	/* 오류 유형, VARCHAR2(2000) */
	,ERR_CONT	/* 오류 내용, CLOB(4000) */
	,BATC_REQT_ID	/* 배치 요청자 ID, VARCHAR2(20) */
	,BATC_REQT_IP	/* 배치 요청자 IP, VARCHAR2(20) */
	,INPT_DT
) VALUES (
	 #{batcExecCd, jdbcType=VARCHAR}
	,#{thedGuid, jdbcType=VARCHAR}
	,#{batcProgType, jdbcType=VARCHAR}
	,#{batcDesc, jdbcType=VARCHAR}
	,#{batcLogType, jdbcType=VARCHAR}
	,#{execStrtMlisSecd, jdbcType=DECIMAL}
	,#{execEndMlisSecd, jdbcType=DECIMAL}
	,#{totlLapMlisSecd, jdbcType=DECIMAL}
	,#{errMsg, jdbcType=VARCHAR}
	,#{errCont, jdbcType=CLOB}
	,#{batcReqtId, jdbcType=VARCHAR}
	,#{batcReqtIp, jdbcType=VARCHAR}
	,TO_DATE(#{inptDt, jdbcType=VARCHAR}, 'yyyyMMddHH24miss')
)
</insert>

<select id="selectEzcApiBatcLog" parameterType="ezcApiBatcLog" resultType="ezcApiBatcLog">
SELECT
	 EZC_API_BATC_LOG.BATC_EXEC_CD AS batcExecCd	/* 배치 실행 코드, VARCHAR2(32) */
	,EZC_API_BATC_LOG.THED_GUID AS thedGuid	/* 쓰레드 GUID, VARCHAR2(32) */
	,EZC_API_BATC_LOG.BATC_PROG_TYPE AS batcProgType	/* 배치 프로그램 타입, VARCHAR2(1000) */
	,EZC_API_BATC_LOG.BATC_DESC AS batcDesc	/* 배치 설명, VARCHAR2(4000) */
	,EZC_API_BATC_LOG.BATC_LOG_TYPE AS batcLogType	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
	,EZC_API_BATC_LOG.EXEC_STRT_MLIS_SECD AS execStrtMlisSecd	/* 실행 시작 밀리 초, NUMBER(0,22) */
	,EZC_API_BATC_LOG.EXEC_END_MLIS_SECD AS execEndMlisSecd	/* 실행 종료 밀리 초, NUMBER(0,22) */
	,EZC_API_BATC_LOG.TOTL_LAP_MLIS_SECD AS totlLapMlisSecd	/* 전체 수행 밀리 초, NUMBER(0,22) */
	,EZC_API_BATC_LOG.ERR_MSG AS errMsg	/* 오류 유형, VARCHAR2(2000) */
	,EZC_API_BATC_LOG.ERR_CONT AS errCont	/* 오류 내용, CLOB(4000) */
	,EZC_API_BATC_LOG.BATC_REQT_ID AS batcReqtId	/* 배치 요청자 ID, VARCHAR2(20) */
	,EZC_API_BATC_LOG.BATC_REQT_IP AS batcReqtIp	/* 배치 요청자 IP, VARCHAR2(20) */
	,TO_CHAR(EZC_API_BATC_LOG.INPT_DT, 'yyyyMMdd') AS inptDt
FROM
	EZC_API_BATC_LOG	/* EZC API 배치 로그 */
WHERE 1=1
	AND EZC_API_BATC_LOG.BATC_EXEC_CD = #{batcExecCd, jdbcType=VARCHAR}	/* 배치 실행 코드, VARCHAR2(32), EZC_API_BATC_LOG_PK(P) */
	AND EZC_API_BATC_LOG.THED_GUID = #{thedGuid, jdbcType=VARCHAR}	/* 쓰레드 GUID, VARCHAR2(32), EZC_API_BATC_LOG_PK(P) */
</select>

<select id="selectCountEzcApiBatcLog" parameterType="ezcApiBatcLog" resultType="java.lang.Integer">
SELECT 
	COUNT(1)
FROM
	EZC_API_BATC_LOG	/* EZC API 배치 로그 */
WHERE 1=1
	<if test="batcExecCd != null and batcExecCd != ''">
	AND EZC_API_BATC_LOG.BATC_EXEC_CD = #{batcExecCd, jdbcType=VARCHAR}	/* 배치 실행 코드, VARCHAR2(32) */
	</if>
	<if test="thedGuid != null and thedGuid != ''">
	AND EZC_API_BATC_LOG.THED_GUID = #{thedGuid, jdbcType=VARCHAR}	/* 쓰레드 GUID, VARCHAR2(32) */
	</if>
	<if test="batcProgType != null and batcProgType != ''">
	AND EZC_API_BATC_LOG.BATC_PROG_TYPE LIKE '%' || #{batcProgType, jdbcType=VARCHAR} || '%'	/* 배치 프로그램 타입, VARCHAR2(1000) */
	</if>
	<if test="batcDesc != null and batcDesc != ''">
	AND EZC_API_BATC_LOG.BATC_DESC LIKE '%' || #{batcDesc, jdbcType=VARCHAR} || '%'	/* 배치 설명, VARCHAR2(4000) */
	</if>
	<if test="batcLogType != null and batcLogType != ''">
	AND EZC_API_BATC_LOG.BATC_LOG_TYPE = #{batcLogType, jdbcType=VARCHAR}	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
	</if>
	<if test="execStrtMlisSecd != null and execStrtMlisSecd gt 0">
	AND EZC_API_BATC_LOG.EXEC_STRT_MLIS_SECD = #{execStrtMlisSecd, jdbcType=DECIMAL}	/* 실행 시작 밀리 초, NUMBER(0,22) */
	</if>
	<if test="execEndMlisSecd != null and execEndMlisSecd gt 0">
	AND EZC_API_BATC_LOG.EXEC_END_MLIS_SECD = #{execEndMlisSecd, jdbcType=DECIMAL}	/* 실행 종료 밀리 초, NUMBER(0,22) */
	</if>
	<if test="totlLapMlisSecd != null and totlLapMlisSecd gt 0">
	AND EZC_API_BATC_LOG.TOTL_LAP_MLIS_SECD = #{totlLapMlisSecd, jdbcType=DECIMAL}	/* 전체 수행 밀리 초, NUMBER(0,22) */
	</if>
	<if test="errMsg != null and errMsg != ''">
	AND EZC_API_BATC_LOG.ERR_MSG LIKE '%' || #{errMsg, jdbcType=VARCHAR} || '%'	/* 오류 유형, VARCHAR2(2000) */
	</if>
	<if test="errCont != null and errCont != ''">
	AND EZC_API_BATC_LOG.ERR_CONT LIKE '%' || #{errCont, jdbcType=CLOB} || '%'	/* 오류 내용, CLOB(4000) */
	</if>
	<if test="batcReqtId != null and batcReqtId != ''">
	AND EZC_API_BATC_LOG.BATC_REQT_ID = #{batcReqtId, jdbcType=VARCHAR}	/* 배치 요청자 ID, VARCHAR2(20) */
	</if>
	<if test="batcReqtIp != null and batcReqtIp != ''">
	AND EZC_API_BATC_LOG.BATC_REQT_IP = #{batcReqtIp, jdbcType=VARCHAR}	/* 배치 요청자 IP, VARCHAR2(20) */
	</if>
	<if test="inptDt != null and inptDt != ''">
	AND TO_CHAR(EZC_API_BATC_LOG.INPT_DT, 'yyyyMMdd') = #{inptDt, jdbcType=VARCHAR}	/* 입력 일자, DATE */
	</if>		
</select>

<select id="selectListEzcApiBatcLog" resultType="ezcApiBatcLog">
SELECT * FROM (
	SELECT ROWNUM AS ROW__NUM, RECORDS.* FROM (
		/* #### SQL Body [[ ################# */
		SELECT
			 EZC_API_BATC_LOG.BATC_EXEC_CD AS batcExecCd	/* 배치 실행 코드, VARCHAR2(32) */
			,EZC_API_BATC_LOG.THED_GUID AS thedGuid	/* 쓰레드 GUID, VARCHAR2(32) */
			,EZC_API_BATC_LOG.BATC_PROG_TYPE AS batcProgType	/* 배치 프로그램 타입, VARCHAR2(1000) */
			,EZC_API_BATC_LOG.BATC_DESC AS batcDesc	/* 배치 설명, VARCHAR2(4000) */
			,EZC_API_BATC_LOG.BATC_LOG_TYPE AS batcLogType	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
			,EZC_API_BATC_LOG.EXEC_STRT_MLIS_SECD AS execStrtMlisSecd	/* 실행 시작 밀리 초, NUMBER(0,22) */
			,EZC_API_BATC_LOG.EXEC_END_MLIS_SECD AS execEndMlisSecd	/* 실행 종료 밀리 초, NUMBER(0,22) */
			,EZC_API_BATC_LOG.TOTL_LAP_MLIS_SECD AS totlLapMlisSecd	/* 전체 수행 밀리 초, NUMBER(0,22) */
			,EZC_API_BATC_LOG.ERR_MSG AS errMsg	/* 오류 유형, VARCHAR2(2000) */
			,EZC_API_BATC_LOG.ERR_CONT AS errCont	/* 오류 내용, CLOB(4000) */
			,EZC_API_BATC_LOG.BATC_REQT_ID AS batcReqtId	/* 배치 요청자 ID, VARCHAR2(20) */
			,EZC_API_BATC_LOG.BATC_REQT_IP AS batcReqtIp	/* 배치 요청자 IP, VARCHAR2(20) */
			,TO_CHAR(EZC_API_BATC_LOG.INPT_DT, 'yyyyMMdd') AS inptDt
		FROM
			EZC_API_BATC_LOG	/* EZC API 배치 로그 */
		WHERE 1=1
			<if test="batcExecCd != null and batcExecCd != ''">
			AND EZC_API_BATC_LOG.BATC_EXEC_CD = #{batcExecCd, jdbcType=VARCHAR}	/* 배치 실행 코드, VARCHAR2(32) */
			</if>
			<if test="thedGuid != null and thedGuid != ''">
			AND EZC_API_BATC_LOG.THED_GUID = #{thedGuid, jdbcType=VARCHAR}	/* 쓰레드 GUID, VARCHAR2(32) */
			</if>
			<if test="batcProgType != null and batcProgType != ''">
			AND EZC_API_BATC_LOG.BATC_PROG_TYPE LIKE '%' || #{batcProgType, jdbcType=VARCHAR} || '%'	/* 배치 프로그램 타입, VARCHAR2(1000) */
			</if>
			<if test="batcDesc != null and batcDesc != ''">
			AND EZC_API_BATC_LOG.BATC_DESC LIKE '%' || #{batcDesc, jdbcType=VARCHAR} || '%'	/* 배치 설명, VARCHAR2(4000) */
			</if>
			<if test="batcLogType != null and batcLogType != ''">
			AND EZC_API_BATC_LOG.BATC_LOG_TYPE = #{batcLogType, jdbcType=VARCHAR}	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
			</if>
			<if test="execStrtMlisSecd != null and execStrtMlisSecd gt 0">
			AND EZC_API_BATC_LOG.EXEC_STRT_MLIS_SECD = #{execStrtMlisSecd, jdbcType=DECIMAL}	/* 실행 시작 밀리 초, NUMBER(0,22) */
			</if>
			<if test="execEndMlisSecd != null and execEndMlisSecd gt 0">
			AND EZC_API_BATC_LOG.EXEC_END_MLIS_SECD = #{execEndMlisSecd, jdbcType=DECIMAL}	/* 실행 종료 밀리 초, NUMBER(0,22) */
			</if>
			<if test="totlLapMlisSecd != null and totlLapMlisSecd gt 0">
			AND EZC_API_BATC_LOG.TOTL_LAP_MLIS_SECD = #{totlLapMlisSecd, jdbcType=DECIMAL}	/* 전체 수행 밀리 초, NUMBER(0,22) */
			</if>
			<if test="errMsg != null and errMsg != ''">
			AND EZC_API_BATC_LOG.ERR_MSG LIKE '%' || #{errMsg, jdbcType=VARCHAR} || '%'	/* 오류 유형, VARCHAR2(2000) */
			</if>
			<if test="errCont != null and errCont != ''">
			AND EZC_API_BATC_LOG.ERR_CONT LIKE '%' || #{errCont, jdbcType=CLOB} || '%'	/* 오류 내용, CLOB(4000) */
			</if>
			<if test="batcReqtId != null and batcReqtId != ''">
			AND EZC_API_BATC_LOG.BATC_REQT_ID = #{batcReqtId, jdbcType=VARCHAR}	/* 배치 요청자 ID, VARCHAR2(20) */
			</if>
			<if test="batcReqtIp != null and batcReqtIp != ''">
			AND EZC_API_BATC_LOG.BATC_REQT_IP = #{batcReqtIp, jdbcType=VARCHAR}	/* 배치 요청자 IP, VARCHAR2(20) */
			</if>
			<if test="inptDt != null and inptDt != ''">
			AND TO_CHAR(EZC_API_BATC_LOG.INPT_DT, 'yyyyMMdd') = #{inptDt, jdbcType=VARCHAR}	/* 입력 일자, DATE */
			</if>				
		ORDER BY
			EZC_API_BATC_LOG.BATC_EXEC_CD DESC
		/* #### SQL Body ]] ################# */
	) RECORDS
	WHERE ROWNUM &lt;= ((#{pageNum, jdbcType=NUMERIC}*#{pageCount, jdbcType=NUMERIC})+1) 
)
WHERE ROW__NUM &gt; (#{pageNum, jdbcType=NUMERIC}-1)*#{pageCount, jdbcType=NUMERIC}
</select>

<update id="updateEzcApiBatcLog" parameterType="ezcApiBatcLog">
UPDATE EZC_API_BATC_LOG SET	/* EZC API 배치 로그 */
	 BATC_PROG_TYPE = #{batcProgType, jdbcType=VARCHAR}	/* 배치 프로그램 타입, VARCHAR2(1000) */
	,BATC_DESC = #{batcDesc, jdbcType=VARCHAR}	/* 배치 설명, VARCHAR2(4000) */
	,BATC_LOG_TYPE = #{batcLogType, jdbcType=VARCHAR}	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
	,EXEC_STRT_MLIS_SECD = #{execStrtMlisSecd, jdbcType=DECIMAL}	/* 실행 시작 밀리 초, NUMBER(0,22) */
	,EXEC_END_MLIS_SECD = #{execEndMlisSecd, jdbcType=DECIMAL}	/* 실행 종료 밀리 초, NUMBER(0,22) */
	,TOTL_LAP_MLIS_SECD = #{totlLapMlisSecd, jdbcType=DECIMAL}	/* 전체 수행 밀리 초, NUMBER(0,22) */
	,ERR_MSG = #{errMsg, jdbcType=VARCHAR}	/* 오류 유형, VARCHAR2(2000) */
	,ERR_CONT = #{errCont, jdbcType=CLOB}	/* 오류 내용, CLOB(4000) */
	,BATC_REQT_ID = #{batcReqtId, jdbcType=VARCHAR}	/* 배치 요청자 ID, VARCHAR2(20) */
	,BATC_REQT_IP = #{batcReqtIp, jdbcType=VARCHAR}	/* 배치 요청자 IP, VARCHAR2(20) */
	,INPT_DT = TO_DATE(#{inptDt, jdbcType=VARCHAR}, 'yyyyMMddHH24miss')
WHERE 1=1
	AND BATC_EXEC_CD = #{batcExecCd, jdbcType=VARCHAR}	/* 배치 실행 코드, VARCHAR2(32) */
	AND THED_GUID = #{thedGuid, jdbcType=VARCHAR}	/* 쓰레드 GUID, VARCHAR2(32) */
</update>

<update id="mergeEzcApiBatcLog" parameterType="ezcApiBatcLog">
MERGE INTO EZC_API_BATC_LOG /* EZC API 배치 로그 */
	USING DUAL ON (
		BATC_EXEC_CD = #{batcExecCd, jdbcType=VARCHAR}	/* 배치 실행 코드, VARCHAR2(32) */
		AND THED_GUID = #{thedGuid, jdbcType=VARCHAR}	/* 쓰레드 GUID, VARCHAR2(32) */
	)
	WHEN MATCHED THEN
		UPDATE SET
			 BATC_PROG_TYPE = #{batcProgType, jdbcType=VARCHAR}	/* 배치 프로그램 타입, VARCHAR2(1000) */
			,BATC_DESC = #{batcDesc, jdbcType=VARCHAR}	/* 배치 설명, VARCHAR2(4000) */
			,BATC_LOG_TYPE = #{batcLogType, jdbcType=VARCHAR}	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
			,EXEC_STRT_MLIS_SECD = #{execStrtMlisSecd, jdbcType=DECIMAL}	/* 실행 시작 밀리 초, NUMBER(0,22) */
			,EXEC_END_MLIS_SECD = #{execEndMlisSecd, jdbcType=DECIMAL}	/* 실행 종료 밀리 초, NUMBER(0,22) */
			,TOTL_LAP_MLIS_SECD = #{totlLapMlisSecd, jdbcType=DECIMAL}	/* 전체 수행 밀리 초, NUMBER(0,22) */
			,ERR_MSG = #{errMsg, jdbcType=VARCHAR}	/* 오류 유형, VARCHAR2(2000) */
			,ERR_CONT = #{errCont, jdbcType=CLOB}	/* 오류 내용, CLOB(4000) */
			,BATC_REQT_ID = #{batcReqtId, jdbcType=VARCHAR}	/* 배치 요청자 ID, VARCHAR2(20) */
			,BATC_REQT_IP = #{batcReqtIp, jdbcType=VARCHAR}	/* 배치 요청자 IP, VARCHAR2(20) */
			,INPT_DT = TO_DATE(#{inptDt, jdbcType=VARCHAR}, 'yyyyMMddHH24miss')
	WHEN NOT MATCHED THEN
		INSERT (
			 BATC_EXEC_CD	/* 배치 실행 코드, VARCHAR2(32) */
			,THED_GUID	/* 쓰레드 GUID, VARCHAR2(32) */
			,BATC_PROG_TYPE	/* 배치 프로그램 타입, VARCHAR2(1000) */
			,BATC_DESC	/* 배치 설명, VARCHAR2(4000) */
			,BATC_LOG_TYPE	/* 배치 로그 유형 ( TM : 시간기록, ER : 에러기록, IV : INVALIDATE 유효성검증실패 ), VARCHAR2(4) */
			,EXEC_STRT_MLIS_SECD	/* 실행 시작 밀리 초, NUMBER(0,22) */
			,EXEC_END_MLIS_SECD	/* 실행 종료 밀리 초, NUMBER(0,22) */
			,TOTL_LAP_MLIS_SECD	/* 전체 수행 밀리 초, NUMBER(0,22) */
			,ERR_MSG	/* 오류 유형, VARCHAR2(2000) */
			,ERR_CONT	/* 오류 내용, CLOB(4000) */
			,BATC_REQT_ID	/* 배치 요청자 ID, VARCHAR2(20) */
			,BATC_REQT_IP	/* 배치 요청자 IP, VARCHAR2(20) */
			,INPT_DT
		) VALUES (
			 #{batcExecCd, jdbcType=VARCHAR}
			,#{thedGuid, jdbcType=VARCHAR}
			,#{batcProgType, jdbcType=VARCHAR}
			,#{batcDesc, jdbcType=VARCHAR}
			,#{batcLogType, jdbcType=VARCHAR}
			,#{execStrtMlisSecd, jdbcType=DECIMAL}
			,#{execEndMlisSecd, jdbcType=DECIMAL}
			,#{totlLapMlisSecd, jdbcType=DECIMAL}
			,#{errMsg, jdbcType=VARCHAR}
			,#{errCont, jdbcType=CLOB}
			,#{batcReqtId, jdbcType=VARCHAR}
			,#{batcReqtIp, jdbcType=VARCHAR}
			,TO_DATE(#{inptDt, jdbcType=VARCHAR}, 'yyyyMMddHH24miss')
		)
</update>

<delete id="deleteEzcApiBatcLog" parameterType="ezcApiBatcLog">
DELETE FROM EZC_API_BATC_LOG /* EZC API 배치 로그 */
WHERE 1=1
	AND BATC_EXEC_CD = #{batcExecCd, jdbcType=VARCHAR}	/* 배치 실행 코드, VARCHAR2(32) */
	AND THED_GUID = #{thedGuid, jdbcType=VARCHAR}	/* 쓰레드 GUID, VARCHAR2(32) */
</delete>


<delete id="deletePrevEzcApiBatcLog" parameterType="ezcApiBatcLog">
DELETE FROM EZC_API_BATC_LOG /* EZC API 배치 로그 */
WHERE 1=1
	AND TO_CHAR(INPT_DT, 'yyyyMMdd')  &lt; TO_CHAR((SYSDATE - #{deleteDay, jdbcType=NUMERIC}), 'yyyyMMdd')	/* 입력일자가 오늘로부터 N일전 모든 데이터 */
</delete>

</mapper>
